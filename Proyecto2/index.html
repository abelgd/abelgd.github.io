<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#0b0b0b">
  <meta charset="UTF-8">
  <title>Proyecto 2: Guía para bastionar el arranque de Ubuntu Server</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    :root {
      --codelab-bg: #0b0b0b;
      --codelab-surface: #151515;
      --codelab-text: #cccccc;
      --codelab-text-muted: #888888;
      --codelab-accent: #8fb3ff;
      --codelab-border: rgba(255,255,255,0.1);
      --title-font: Georgia, "Times New Roman", Times, serif;
    }

    body {
      background: var(--codelab-bg) !important;
      color: var(--codelab-text) !important;
    }

    #codelab-title,
    #main-toolbar,
    google-codelab {
      background: var(--codelab-surface) !important;
      --primary-color: var(--codelab-accent) !important;
      --secondary-color: var(--codelab-text-muted) !important;
    }

    h1, h2, h3, h4, h5, h6 {
      color: #ffffff !important;
      font-family: var(--title-font) !important;
      font-weight: 300 !important;
    }

    /* Forzar estilos del drawer y steps */
    #drawer,
    #steps {
      background: #000000 !important;
      border-right: 1px solid var(--codelab-border) !important;
    }

    #drawer *,
    #steps * {
      background: transparent !important;
    }

    .step {
      color: #ffffff !important;
      background: #000000 !important;
      border-left: 3px solid transparent !important;
      transition: all 0.3s ease !important;
    }

    .step.selected {
      color: #ffffff !important;
      background: rgba(143, 179, 255, 0.15) !important;
      border-left-color: var(--codelab-accent) !important;
    }

    .step:hover {
      color: #ffffff !important;
      background: rgba(255, 255, 255, 0.08) !important;
      border-left-color: var(--codelab-accent) !important;
    }

    #drawer h2,
    #drawer h3,
    #drawer span,
    #drawer div,
    #steps h2,
    #steps h3,
    #steps span,
    #steps div {
      color: #ffffff !important;
      background: transparent !important;
    }

    #codelab-step,
    .instructions {
      background: var(--codelab-bg) !important;
      color: var(--codelab-text) !important;
    }

    p, li, td, th, span, label {
      color: var(--codelab-text) !important;
    }

    a {
      color: var(--codelab-accent) !important;
      text-decoration: none !important;
      border-bottom: 1px solid rgba(143,179,255,0.3) !important;
      transition: all 0.3s ease !important;
    }

    a:hover {
      color: #ffffff !important;
      border-bottom-color: rgba(143,179,255,0.6) !important;
    }

    pre,
    code,
    .prettyprint {
      background: #1a1a1a !important;
      color: #e0e0e0 !important;
      border: 1px solid var(--codelab-border) !important;
      border-radius: 4px !important;
    }

    aside {
      background: rgba(255,255,255,0.02) !important;
      border-left: 4px solid var(--codelab-accent) !important;
      color: var(--codelab-text) !important;
      padding: 16px 20px !important;
      border-radius: 4px !important;
    }

    table {
      background: var(--codelab-surface) !important;
      border: 1px solid var(--codelab-border) !important;
    }

    th {
      background: rgba(255,255,255,0.05) !important;
      color: #ffffff !important;
      border-bottom: 2px solid var(--codelab-border) !important;
    }

    td {
      border: 1px solid var(--codelab-border) !important;
    }

    tr:hover {
      background: rgba(255,255,255,0.02) !important;
    }

    paper-button,
    button,
    .codelab-fab {
      background: transparent !important;
      color: #ffffff !important;
      border: 1px solid rgba(255,255,255,0.3) !important;
      transition: all 0.3s ease !important;
    }

    paper-button:hover,
    button:hover {
      background: rgba(255,255,255,0.05) !important;
      border-color: #ffffff !important;
    }

    img {
      border: 1px solid var(--codelab-border) !important;
      border-radius: 6px !important;
      background: #ffffff !important;
      padding: 8px !important;
      max-width: 100% !important;
    }

    #codelab-footer {
      background: var(--codelab-surface) !important;
      border-top: 1px solid var(--codelab-border) !important;
      color: var(--codelab-text-muted) !important;
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--codelab-surface);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,0.3);
    }

    .success {
      color: #66bb6a !important;
    }
    
    .error {
      color: #ff5252 !important;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid="ID de Google Analytics"
                  id="identificador2"
                  title="Proyecto 2: Guía para bastionar el arranque de Ubuntu Server"
                  environment="web"
                  feedback-link="https://github.com/abelgd/abelgd.github.io/issues/1">
    
    <google-codelab-step label="Introducción" duration="0">
      <p>El proceso de arranque de un sistema operativo es una fase crítica en la que se cargan los componentes esenciales del sistema.<br> Bastionar el arranque de <strong>Ubuntu Server</strong> consiste en aplicar configuraciones y medidas de seguridad que garanticen la <strong>integridad</strong>, <strong>confidencialidad</strong> y <strong>autenticidad</strong> del sistema desde el momento en que se enciende el equipo.</p>
<p>El objetivo de esta guía es proporcionar una base técnica y estructurada para asegurar el arranque de Ubuntu, reduciendo riesgos de manipulación o acceso no autorizado durante las fases iniciales del sistema.</p>
<h3 is-upgraded>Autor: <em>Abel García Domínguez</em></h3>
    </google-codelab-step>
    
    <google-codelab-step label="Configuración y medidas de bastionado del arranque" duration="0">
      <p>En esta práctica se realizará la instalación y configuración segura de <strong>Ubuntu Server 24.04.3 LTS (minimized)</strong>, aplicando medidas de seguridad desde el proceso de instalación.<br> El bastionado comienza en el propio instalador, donde definiremos una estructura de particiones cifradas y configuraciones de arranque seguras.</p>
<h2 is-upgraded>Requisitos previos</h2>
<p>Antes de comenzar, asegúrate de contar con los siguientes elementos:</p>
<ul>
<li>Imagen ISO de Ubuntu Server 24.04.3 LTS: <em>ubuntu-24.04.3-live-server-amd64.iso</em></li>
<li>Máquina virtual o equipo físico preparado para la instalación.</li>
</ul>
<h2 is-upgraded>Medida de seguridad inicial: adaptador de red activo hasta el mirror</h2>
<ul>
<li>Antes de iniciar la instalación, se debe <strong>mantener el adaptador de red activado</strong> para permitir que el instalador configure correctamente los componentes de red del sistema y detecte los recursos necesarios al finalizar la instalación.</li>
<li>Una vez alcanzado el paso del <strong>mirror (Ubuntu archive mirror)</strong>, se procederá a <strong>desactivar el adaptador de red</strong> para evitar la descarga de paquetes desde fuentes externas no verificadas.</li>
<li>El adaptador de red <strong>se volverá a activar</strong> una vez completada la instalación, justo antes de la configuración del GRUB.</li>
</ul>
    </google-codelab-step>
    
    <google-codelab-step label="Instalación de Ubuntu Server 24.04.3 LTS" duration="0">
      <h2 is-upgraded>Paso 1: Iniciar la instalación</h2>
<ol type="1">
<li>Inicia la máquina virtual utilizando la ISO: <em>ubuntu-24.04.3-live-server-amd64.iso</em>. Selecciona la opción <em>Omitir la instalación desatendida</em></li>
<li>En el menú inicial, selecciona la opción: <em>Try or Install Ubuntu Server</em></li>
</ol>
<p class="image-container"><img alt="Imagen1" src="img\\47f86acaa9f31dba.png"></p>
<ol type="1" start="3">
<li>Elige el idioma de instalación y pulsa <em>Enter</em></li>
</ol>
<p class="image-container"><img alt="Imagen2" src="img\\1a05b1867ad59fc3.png"></p>
<ol type="1" start="4">
<li>Configura el diseño de teclado según corresponda.</li>
</ol>
<p class="image-container"><img alt="Imagen3" src="img\\ce80f12a6f6882b2.png"></p>
<ol type="1" start="5">
<li>En la pantalla <strong>"Choose the type of installation"</strong>, selecciona: <em>Ubuntu Server (minimized)</em></li>
</ol>
<ul>
<li>Esta opción instala un sistema base reducido, más seguro y sin paquetes innecesarios.</li>
</ul>
<p class="image-container"><img alt="Imagen4" src="img\\bb791cfbbcc2f141.png"></p>
<h2 is-upgraded>Paso 2: Configuración de red, proxy y mirror</h2>
<p>Durante la instalación, se presentan tres apartados relacionados con la conectividad y descarga de paquetes:</p>
<ul>
<li><strong>Configuración de red (Network connections)</strong></li>
<li><strong>Proxy</strong></li>
<li><strong>Mirror del repositorio (Ubuntu archive mirror)</strong></li>
</ul>
<p>En nuestro caso, <strong>omitiremos su configuración manual</strong> por motivos de seguridad y control de entorno.</p>
<ul>
<li><strong>Al llegar al paso del mirror</strong>, se debe <strong>desactivar el adaptador de red.</strong></li>
</ul>
<h2 is-upgraded>Paso 3: Configuración del almacenamiento</h2>
<p>En este apartado se definirá el esquema de particiones del sistema.<br> El objetivo es crear una estructura <strong>segura y cifrada</strong>, protegiendo los datos desde el arranque.</p>
<ol type="1">
<li>En la pantalla <strong>"Guided storage configuration"</strong>, selecciona: <em>Custom storage layout</em></li>
</ol>
<p class="image-container"><img alt="Imagen5" src="img\\adf93eba505f15c5.png"></p>
<p>Esta opción permite definir manualmente las particiones del sistema, garantizando un mayor control sobre su estructura y posibilitando la aplicación de cifrado en los volúmenes de datos.</p>
<ol type="1" start="2">
<li>Aparecerá la interfaz <strong>"Storage configuration"</strong>, donde se mostrará el disco disponible. Desde esta interfaz se crearán:</li>
</ol>
<p class="image-container"><img alt="Imagen6" src="img\\6633e6adf6132a34.png"></p>
<h2 is-upgraded>Estructura de particionado recomendada</h2>
<table>
<tr><td colspan="1" rowspan="1"><p>Punto de montaje</p>
</td><td colspan="1" rowspan="1"><p>Tamaño aproximado</p>
</td><td colspan="1" rowspan="1"><p>Cifrado</p>
</td><td colspan="1" rowspan="1"><p>Descripción</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><code>/boot</code></p>
</td><td colspan="1" rowspan="1"><p>1 GB</p>
</td><td colspan="1" rowspan="1"><p>No</p>
</td><td colspan="1" rowspan="1"><p>Contiene el kernel y archivos de arranque</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Espacio restante</p>
</td><td colspan="1" rowspan="1"><p>Todo el disco</p>
</td><td colspan="1" rowspan="1"><p>Sí</p>
</td><td colspan="1" rowspan="1"><p>Volumen LUKS cifrado con LVM</p>
</td></tr>
</table>
<h2 is-upgraded>Pasos de configuración del disco</h2>
<ol type="1">
<li>Crear partición <code>/boot</code> (1 GB) sin cifrar.</li>
<li>Crear una segunda partición con el resto del espacio sin formato.</li>
<li>Crear un <strong>grupo de volúmenes LVM</strong> sobre esa partición.</li>
<li>Activar <strong>cifrado LUKS</strong> y establecer una contraseña segura.</li>
<li>Crear los siguientes volúmenes lógicos dentro del grupo cifrado:</li>
</ol>
<table>
<tr><td colspan="1" rowspan="1"><p>Volumen</p>
</td><td colspan="1" rowspan="1"><p>Punto de montaje</p>
</td><td colspan="1" rowspan="1"><p>Tamaño aprox.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>root</p>
</td><td colspan="1" rowspan="1"><p>(<code>/</code>)</p>
</td><td colspan="1" rowspan="1"><p>10 GB</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>home</p>
</td><td colspan="1" rowspan="1"><p>(<code>/home</code>)</p>
</td><td colspan="1" rowspan="1"><p>6 GB</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>var</p>
</td><td colspan="1" rowspan="1"><p>(<code>/var</code>)</p>
</td><td colspan="1" rowspan="1"><p>4 GB</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>tmp</p>
</td><td colspan="1" rowspan="1"><p>(<code>/tmp</code>)</p>
</td><td colspan="1" rowspan="1"><p>1.5 GB</p>
</td></tr>
<tr><td colspan="2" rowspan="1"><p>swap</p>
</td><td colspan="1" rowspan="1"><p>2 GB</p>
</td></tr>
</table>
<p>Esta estructura segmenta el sistema en diferentes áreas protegidas y evita que fallos en una partición afecten a las demás.</p>
<h2 is-upgraded>Paso 4: Finalización de la instalación</h2>
<ol type="1">
<li>Crear el usuario administrador y establecer la contraseña.</li>
</ol>
<p class="image-container"><img alt="Imagen7" src="img\\aabeeea4be300234.png"></p>
<ol type="1" start="2">
<li>Omitir <strong>Ubuntu Pro</strong> y <strong>SSH</strong> durante la instalación.</li>
</ol>
<p class="image-container"><img alt="Imagen8" src="img\\cf89f5bc1c60c639.png"></p>
<ol type="1" start="3">
<li>Una vez completada, reiniciar el sistema.</li>
</ol>
<p class="image-container"><img alt="Imagen9" src="img\\e2cf4a3c424c7ce9.png"></p>
<ol type="1" start="4">
<li>Iniciar sesión y <strong>verificar las particiones:</strong></li>
</ol>
<p class="image-container"><img alt="Imagen10" src="img\\f33aea0345eca1.png"></p>
    </google-codelab-step>
    
    <google-codelab-step label="Configuración posterior al arranque y bastionado del sistema" duration="0">
      <p>Una vez finalizada la instalación del sistema, se procederá a aplicar medidas de seguridad adicionales sobre el arranque, el kernel y los puntos de montaje.<br> El objetivo de este apartado es <strong>reforzar la integridad del sistema</strong> frente a accesos no autorizados o manipulaciones en las fases iniciales del arranque.</p>
<h2 is-upgraded>Paso 5: Reactivar el adaptador de red e instalar utilidades</h2>
<p>Antes de continuar con la configuración del GRUB, es necesario <strong>reactivar el adaptador de red</strong> para poder instalar las herramientas requeridas. Actualizar los repositorios e instalar el editor <strong>'nano'</strong>.</p>
<h2 is-upgraded>Paso 6: Configuración segura del gestor de arranque (GRUB)</h2>
<p>El gestor de arranque <strong>GRUB</strong> será protegido mediante una contraseña cifrada, impidiendo el acceso no autorizado al menú de arranque o la modificación de parámetros críticos del sistema.</p>
<h3 is-upgraded>6.1 Generar el hash PBKDF2</h3>
<p>Ejecuta el siguiente comando para generar el hash de la contraseña del GRUB: <strong><em>sudo grub-mkpasswd-pbkdf2</em></strong></p>
<p class="image-container"><img alt="Imagen11" src="img\\e3df0c1a444ab550.png"></p>
<h3 is-upgraded>6.2 Crear una copia de seguridad y configurar el archivo /etc/grub.d/40_custom</h3>
<ul>
<li>Antes de modificar el archivo, <strong>realiza una copia de seguridad</strong> para poder restaurarlo en caso de error: <strong><em>sudo cp /etc/grub.d/40_custom /etc/grub.d/40_custom.bak</em></strong></li>
<li>Abrir y editar el archivo personalizado del GRUB: <strong><em>sudo nano /etc/grub.d/40_custom</em></strong></li>
<li>Añadir el siguiente comando: <strong><em>set superusers="grubadmin" password_pbkdf2 grubadmin grub.pbkdf2.sha512.100000.[HASH_GENERADO]</em></strong></li>
</ul>
<p><img alt="Imagen12" src="img\\55ac54469eb5b61f.png"></p>
<p>El usuario <em>admin</em> se define como superusuario del GRUB y usará el hash PBKDF2 para autenticación.</p>
<h3 is-upgraded>6.3 Actualizar GRUB y aplicar permisos</h3>
<p>Actualizar la configuración del GRUB y restringir permisos:</p>
<ul>
<li><strong><em>sudo update-grub</em></strong></li>
<li><strong><em>sudo chmod 600 /boot/grub/grub.cfg</em></strong></li>
<li><strong><em>sudo chown root:root /boot/grub/grub.cfg</em></strong></li>
<li><strong><em>sudo chmod 700 /etc/grub.d/40_custom</em></strong></li>
</ul>
<p class="image-container"><img alt="Imagen13" src="img\\c79e4d617e1bfefc.png"></p>
<p>Estos permisos garantizan que solo <strong>root</strong> pueda leer o modificar la configuración crítica del gestor de arranque.</p>
<h3 is-upgraded>6.4 Ocultar el menú del GRUB</h3>
<ul>
<li>Editar el archivo de configuración por defecto con el comando: <strong><em>sudo nano /etc/default/grub</em></strong></li>
<li>Modificar la variable <strong><em>GRUB_TIMEOUT=0</em></strong> para que el menú del GRUB no aparezca durante el arranque.</li>
</ul>
<p>El sistema arrancará directamente sin mostrar el menú del GRUB, evitando accesos no autorizados al gestor de arranque.</p>
<h2 is-upgraded>Paso 7: Restringir permisos del kernel</h2>
<p>Aplicar permisos restrictivos sobre los binarios y archivos del kernel ubicados en <strong><em>/boot</em></strong> a través de los siguientes comandos:</p>
<p class="image-container"><img alt="Imagen14" src="img\\55922409f3212157.png"></p>
<p>Con el objetivo de prevenir lecturas o modificaciones no autorizadas de los artefactos críticos del kernel, protegiendo así la integridad del sistema.</p>
<h2 is-upgraded>Paso 8: Configuración de montajes seguros en /etc/fstab</h2>
<p>El archivo /etc/fstab define cómo se montan las particiones del sistema. Aplicar opciones restrictivas reduce el riesgo de ejecución de código malicioso o de escaladas de privilegios.</p>
<h3 is-upgraded>8.1 Crear copia de seguridad y editar /etc/fstab</h3>
<ul>
<li>Antes de editar el archivo realiza una copia de seguridad: <strong><em>sudo cp /etc/fstab /etc/fstab.bak</em></strong></li>
<li>Abrir el archivo con privilegios de administrador: <strong><em>sudo nano /etc/fstab</em></strong>.</li>
<li>Editar el archivo de la siguiente forma:</li>
</ul>
<p class="image-container"><img alt="Imagen15" src="img\\8fe522025d2c250.png"></p>
<p>Opciones de seguridad:</p>
<ul>
<li>"<strong>nodev</strong>: evita el uso de dispositivos especiales."</li>
<li>"<strong>nosuid</strong>: bloquea la ejecución con privilegios elevados (SUID/SGID)."</li>
<li>"<strong>noexec</strong>: impide ejecutar binarios desde ese sistema de archivos."</li>
<li>"<strong>ro</strong>: monta el sistema de solo lectura (aplicable a /boot)."</li>
</ul>
<h3 is-upgraded>8.2 Aplicar las nuevas opciones de montaje</h3>
<p class="image-container"><img alt="Imagen16" src="img\\d627ab26d8d88007.png"></p>
    </google-codelab-step>
    
    <google-codelab-step label="Conclusión" duration="0">
      <p>Mediante las configuraciones aplicadas se ha logrado:</p>
<ul>
<li>Proteger el <strong>gestor de arranque GRUB</strong> con contraseña cifrada y permisos restringidos.</li>
<li>Asegurar la <strong>integridad del kernel</strong> mediante permisos seguros sobre los binarios del sistema.</li>
<li>Implementar <strong>montajes seguros</strong> que previenen la ejecución o manipulación indebida de archivos en directorios sensibles.</li>
<li>Incorporar <strong>copias de seguridad preventivas</strong> antes de modificar archivos críticos, garantizando la capacidad de recuperación ante errores de configuración.</li>
</ul>
<p>Estas medidas fortalecen el bastionado del arranque de <strong>Ubuntu Server</strong>, garantizando un entorno más robusto frente a accesos no autorizados.</p>
    </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

  <script>
    // Forzar estilos del drawer penetrando el Shadow DOM
    function applyDrawerStyles() {
      const codelab = document.querySelector('google-codelab');
      if (codelab && codelab.shadowRoot) {
        const shadowRoot = codelab.shadowRoot;
        
        // Crear un style tag dentro del shadow root
        const style = document.createElement('style');
        style.textContent = `
          #drawer {
            background: #000000 !important;
          }
          
          #steps {
            background: #000000 !important;
          }
          
          .step {
            color: #ffffff !important;
            background: #000000 !important;
          }
          
          .step.selected {
            background: rgba(143, 179, 255, 0.15) !important;
            border-left: 3px solid #8fb3ff !important;
          }
          
          .step:hover {
            background: rgba(255, 255, 255, 0.08) !important;
          }
          
          #drawer h2,
          #drawer h3,
          #drawer span,
          #drawer div,
          #steps span,
          #steps div {
            color: #ffffff !important;
          }
        `;
        
        shadowRoot.appendChild(style);
      }
    }

    // Intentar aplicar estilos cuando el DOM esté listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(applyDrawerStyles, 100);
        setTimeout(applyDrawerStyles, 500);
        setTimeout(applyDrawerStyles, 1000);
      });
    } else {
      setTimeout(applyDrawerStyles, 100);
      setTimeout(applyDrawerStyles, 500);
      setTimeout(applyDrawerStyles, 1000);
    }

    // Observar cambios en el DOM para reaplicar estilos
    const observer = new MutationObserver(() => {
      applyDrawerStyles();
    });

    setTimeout(() => {
      const codelab = document.querySelector('google-codelab');
      if (codelab) {
        observer.observe(codelab, { childList: true, subtree: true });
      }
    }, 500);
  </script>

</body>
</html>